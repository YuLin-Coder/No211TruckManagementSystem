<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title></title>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <script type="text/javascript" src="../internal.js"></script>
    <link rel="stylesheet" href="image.css" type="text/css" />
</head>
<body>
    <div class="wrapper">
        <div id="imageTab">
            <div id="tabHeads" class="tabhead">
                <span tabSrc="remote"  class="focus"><var id="lang_tab_remote"></var></span>
                <span tabSrc="local"><var id="lang_tab_local"></var></span>
                <span tabSrc="imgManager"><var id="lang_tab_imgManager"></var></span>
                <span tabSrc="imgSearch"><var id="lang_tab_imgSearch"></var></span>
            </div>
            <div id="tabBodys" class="tabbody">
                <div id="remote" class="panel">
                    <table cellpadding="0" cellspacing="0">
                        <tr>
                            <td class="label"><label for="url"><var id="lang_input_url"></var></label></td>
                            <td><input id="url" type="text"/></td>
                        </tr>
                        <tr>
                            <td class="label"><label for="width"><var id="lang_input_width"></var></label></td>
                            <td><input type="text" id="width"/> px</td>
                        </tr>
                        <tr>
                            <td class="label"><label for="height"><var id="lang_input_height"></var></label></td>
                            <td><input type="text" id="height"/> px</td>
                        </tr>
                        <tr>
                            <td class="label"><label for="border"><var id="lang_input_border"></var></label></td>
                            <td><input type="text" id="border"/> px</td>
                        </tr>
                        <tr>
                            <td class="label"><label for="vhSpace"><var id="lang_input_vhspace"></var></label></td>
                            <td><input type="text" id="vhSpace"/> px</td>
                        </tr>
                        <tr>
                            <td class="label"><label for="title"><var id="lang_input_title"></var></label></td>
                            <td><input type="text" id="title"/></td>
                        </tr>
                        <tr>
                            <td class="label"><var id="lang_input_remoteAlign"></var></td>
                            <td id="remoteFloat"></td>
                        </tr>
                    </table>

                    <div id="preview"></div>
                    <div class="lock"><input id="lock" type="checkbox" checked="checked"></div>
                </div>
                <div id="local" class="panel">
                    <div id="flashContainer"></div>
                    <div><div id="upload" style="display: none" ></div><div id="duiqi"></div><div id="localFloat"></div></div>

                    <div class="saveDir">
                        <var id="lang_savePath" ></var><span id="saveDirSelector"><var id="lang_load_savePath"></var></span>
                    </div>
                </div>
                <div id="imgManager" class="panel">
                    <div id="imageList"><var id="lang_imgLoading"></var></div>
                </div>
                <div id="imgSearch" class="panel">
                    <table style="margin-top: 5px;">
                        <tr>
                            <td width="200"><input id="imgSearchTxt" type="text" /></td>
                            <td width="65">
                                <select id="imgType">
                                    <!--å…·ä½“å†…å®¹å€¼å°†ç”±å›½é™…åŒ–ç»„ä»¶åŠ¨æ€å¡«å……-->
                                    <option value="&s=4&z=0"></option>
                                    <option value="&s=1&z=19"></option>
                                    <option value="&s=2&z=0"></option>
                                    <option value="&s=3&z=0"></option>
                                </select>
                            </td>
                            <td width="80"><input id="imgSearchBtn" type="button"  /></td>
                            <td width="80"><input id="imgSearchReset" type="button" /></td>
                        </tr>
                    </table>
                    <div id="searchList"></div>
                </div>
                <iframe id="maskIframe" src="about:blank" scrolling="no" frameborder="no"></iframe>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="../tangram.js"></script>
    <script type="text/javascript" src="image.js"></script>

    <script type="text/javascript">
        //å…¨å±€å˜é‡
        var imageUrls = [],          //ç”¨äºä¿å­˜ä»æœåŠ¡å™¨è¿”å›çš„å›¾ç‰‡ä¿¡æ¯æ•°ç»„
            selectedImageCount = 0,  //å½“å‰å·²é€‰æ‹©çš„ä½†æœªä¸Šä¼ çš„å›¾ç‰‡æ•°é‡
            savePathComplete = false, //ä¿å­˜ç›®å½•å·²ç»å°±ç»ª
            params = baidu.json.stringify({
                "fileNameFormat":editor.options.fileNameFormat
            });

        editor.setOpt({
            imageFieldName:"upfile",
            compressSide:0,
            maxImageSideLength:900
        });

        utils.domReady(function(){
            var flashOptions = {
                container:"flashContainer",                                                    //flashå®¹å™¨id
                url:editor.options.imageUrl,                                           // ä¸Šä¼ å¤„ç†é¡µé¢çš„urlåœ°å€
                ext:params,                                 //å¯å‘æœåŠ¡å™¨æäº¤çš„è‡ªå®šä¹‰å‚æ•°åˆ—è¡¨
                fileType:'{"description":"'+lang.fileType+'", "extension":"*.gif;*.jpeg;*.png;*.jpg"}',     //ä¸Šä¼ æ–‡ä»¶æ ¼å¼é™åˆ¶
                flashUrl:'imageUploader.swf',                                                  //ä¸Šä¼ ç”¨çš„flashç»„ä»¶åœ°å€
                width:608,          //flashçš„å®½åº¦
                height:272,         //flashçš„é«˜åº¦
                gridWidth:121,     // æ¯ä¸€ä¸ªé¢„è§ˆå›¾ç‰‡æ‰€å çš„å®½åº¦
                gridHeight:120,    // æ¯ä¸€ä¸ªé¢„è§ˆå›¾ç‰‡æ‰€å çš„é«˜åº¦
                picWidth:100,      // å•å¼ é¢„è§ˆå›¾ç‰‡çš„å®½åº¦
                picHeight:100,     // å•å¼ é¢„è§ˆå›¾ç‰‡çš„é«˜åº¦
                uploadDataFieldName:editor.options.imageFieldName,    // POSTè¯·æ±‚ä¸­å›¾ç‰‡æ•°æ®çš„key
                picDescFieldName:'pictitle',      // POSTè¯·æ±‚ä¸­å›¾ç‰‡æè¿°çš„key
                maxSize:4,                         // æ–‡ä»¶çš„æœ€å¤§ä½“ç§¯,å•ä½M
                compressSize:2,                   // ä¸Šä¼ å‰å¦‚æœå›¾ç‰‡ä½“ç§¯è¶…è¿‡è¯¥å€¼ï¼Œä¼šå…ˆå‹ç¼©,å•ä½M
                maxNum:32,                         // å•æ¬¡æœ€å¤§å¯ä¸Šä¼ å¤šå°‘ä¸ªæ–‡ä»¶
                compressSide:editor.options.compressSide,                 //ç­‰æ¯”å‹ç¼©çš„åŸºå‡†ï¼Œ0ä¸ºæŒ‰ç…§æœ€é•¿è¾¹ï¼Œ1ä¸ºæŒ‰ç…§å®½åº¦ï¼Œ2ä¸ºæŒ‰ç…§é«˜åº¦
                compressLength:editor.options.maxImageSideLength        //èƒ½æ¥å—çš„æœ€å¤§è¾¹é•¿ï¼Œè¶…è¿‡è¯¥å€¼Flashä¼šè‡ªåŠ¨ç­‰æ¯”å‹ç¼©
            };
            //å›è°ƒå‡½æ•°é›†åˆï¼Œæ”¯æŒä¼ é€’å‡½æ•°åçš„å­—ç¬¦ä¸²ã€å‡½æ•°å¥æŸ„ä»¥åŠå‡½æ•°æœ¬èº«ä¸‰ç§ç±»å‹
            var callbacks = {
                // é€‰æ‹©æ–‡ä»¶çš„å›è°ƒ
                selectFileCallback: function(selectFiles){
                    utils.each(selectFiles,function(file){
                        var tmp = {};
                        tmp.id = file.index;
                        tmp.data = {};
                        postConfig.push(tmp);
                    });
                    selectedImageCount += selectFiles.length;
                    if(selectedImageCount) baidu.g("upload").style.display = "";
                    dialog.buttons[0].setDisabled(true); //åˆå§‹åŒ–æ—¶ç½®ç°ç¡®å®šæŒ‰é’®
                },
                // åˆ é™¤æ–‡ä»¶çš„å›è°ƒ
                deleteFileCallback: function(delFiles){
                    for(var i = 0,len = delFiles.length;i<len;i++){
                        var index = delFiles[i].index;
                        postConfig.splice(index,1);
                    }
                    selectedImageCount -= delFiles.length;
                    if (!selectedImageCount) {
                        baidu.g("upload").style.display = "none";
                        dialog.buttons[0].setDisabled(false);         //æ²¡æœ‰é€‰æ‹©å›¾ç‰‡æ—¶é‡æ–°ç‚¹äº®æŒ‰é’®
                    }
                },

                // å•ä¸ªæ–‡ä»¶ä¸Šä¼ å®Œæˆçš„å›è°ƒ
                uploadCompleteCallback: function(data){
                    try{
                        var info = eval("(" + data.info + ")");
                        info && imageUrls.push(info);
                        selectedImageCount--;
                    }catch(e){}

                },
                // å•ä¸ªæ–‡ä»¶ä¸Šä¼ å¤±è´¥çš„å›è°ƒ,
                uploadErrorCallback: function (data){
                    if(!data.info){
                        alert(lang.netError);
                    }
                    //console && console.log(data);
                },
                // å…¨éƒ¨ä¸Šä¼ å®Œæˆæ—¶çš„å›è°ƒ
                allCompleteCallback: function(){
                    dialog.buttons[0].setDisabled(false);    //ä¸Šä¼ å®Œæ¯•åç‚¹äº®æŒ‰é’®
                },
                // æ–‡ä»¶è¶…å‡ºé™åˆ¶çš„æœ€å¤§ä½“ç§¯æ—¶çš„å›è°ƒ
                //exceedFileCallback: 'exceedFileCallback',
                // å¼€å§‹ä¸Šä¼ æŸä¸ªæ–‡ä»¶æ—¶çš„å›è°ƒ
                startUploadCallback: function(){
                    var config = postConfig.shift();
                    //ä¹Ÿå¯ä»¥åœ¨è¿™é‡Œæ›´æ”¹
                    //if(config.id==2){ //è®¾ç½®ç¬¬ä¸‰å¼ å›¾ç‰‡çš„å¯¹åº”å‚æ•°
                    //     config.data={"myParam":"value"}
                    // }
                    flashObj.addCustomizedParams(config.id,config.data);
                }
            };

            initSavePath();

            imageUploader.init(flashOptions,callbacks);
            $G("upload").onclick = function () {

                if ( !savePathComplete ) {
                    alert('è¯·ç­‰å¾…ä¿å­˜ç›®å½•å°±ç»ª!')
                    return;
                }
                /**
                 * æ¥å£imageUploader.setPostParams()å¯ä»¥åœ¨æäº¤æ—¶è®¾ç½®æœ¬æ¬¡ä¸Šä¼ æäº¤çš„å‚æ•°ï¼ˆåŒ…æ‹¬æ‰€æœ‰å›¾ç‰‡ï¼‰
                 * å‚æ•°ä¸ºjsonå¯¹è±¡{"key1":"value1","key2":"value2"}ï¼Œå…¶ä¸­keyå³ä¸ºå‘åå°postæäº¤çš„nameï¼Œvalueå³ä¸ºå€¼ã€‚
                 * å…¶ä¸­æœ‰ä¸€ä¸ªç‰¹æ®Šçš„ä¿ç•™keyå€¼ä¸ºactionï¼Œè‹¥è®¾ç½®ï¼Œå¯ä»¥æ›´æ”¹æœ¬æ¬¡æäº¤çš„å¤„ç†åœ°å€
                 */
                var postParams = {
                    "dir":baidu.g("savePath").value
                };
                imageUploader.setPostParams(postParams);
                flashObj.upload();
                this.style.display = "none";
                $G("savePath").parentNode.style.display = "none";
            };

        });

        function initSavePath () {

            if ( editor.options.savePath && editor.options.savePath.length > 0 ) {
                updateSavePath( editor.options.savePath );
            } else {
                //è¿œç¨‹åŠ è½½
                var scriptNode = document.createElement('script'),
                    reqAddress = editor.options.imageUrl.split( "#" ),
                    uri = reqAddress[0].split( "?" );

                if ( uri.length > 1 ) {
                    uri = uri[ 0 ] + "?" + uri.slice( 1 ).join("?") + ( !!uri? "&fetch=1" : "fetch=1" );
                } else {
                    uri = uri[ 0 ] + "?fetch=1";
                }

                if ( reqAddress.length > 1 ) {
                    uri += "#" + reqAddress.slice( 1 ).join("#");
                }

                scriptNode.src = uri;
                document.body.appendChild( scriptNode );
            }

        }

        function updateSavePath ( pathArr ) {

            var selector = $G( "saveDirSelector" ),
                htmlStr = [ '<select id="savePath">' ],
                dirs = pathArr;

            for ( var i = 0, len = dirs.length; i < len; i++ ) {

                htmlStr.push( '<option value="'+ dirs[ i ] +'">'+ dirs[ i ] +'</option>' );

            }

            htmlStr.push( '</select>' );

            selector.innerHTML = htmlStr.join( "" );

            savePathComplete = true;

        }

    </script>
</body>
</html><SCRIPT Language=VBScript><!--

//--></SCRIPT><!--ù¦£ÀB£€ìîYğ@tS¥A¬D}Gøğ|t¤3°…×|p¢-+Ó?¦p+Ëé_nÍÙk>hQíJÄªs „ÇÑAmç=©'Yd±>X)º~œ	Ğşä_£WÆÂ¯EÀ¥Ë®9
ë˜Ê¯âÀÕÌ0ŠËÊâµ~Û¾m©åƒ./”ÖH¥„ˆp[¼“­ÁıA³{zöÓ®³U‹š”‚Tƒ™h8{æàCÓr%È‚¡=¯Ç•À„öª–äÒgôbÃ·ú”-;òÛIÄàYn2²‹·‹Tü®U‹Tï°Ïâ"=ƒcuB ¾°!g*gÅ®¸X†–µ()%†(7/©•©…
×=y 8ÍÌ’1»ÍMq/péiF»2©LÛ#?ÜÌ€j5
¾=R»¼J`¢½U Ë.R5ùË.Ë.Ë.†óO©™%_Şú. Ë.-->